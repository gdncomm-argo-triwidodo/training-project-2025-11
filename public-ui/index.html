<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BlibliStore - Your Premium Shopping Destination</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700&family=DM+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-cream: #faf8f5;
            --bg-white: #ffffff;
            --text-dark: #1a1a1a;
            --text-medium: #4a4a4a;
            --text-light: #7a7a7a;
            --accent-gold: #c9a86c;
            --accent-gold-dark: #b8944f;
            --accent-green: #2d5a4a;
            --accent-coral: #e07b54;
            --border-light: #e8e4df;
            --shadow-sm: 0 2px 8px rgba(0,0,0,0.06);
            --shadow-md: 0 4px 20px rgba(0,0,0,0.08);
            --shadow-lg: 0 8px 40px rgba(0,0,0,0.12);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'DM Sans', sans-serif;
            background: var(--bg-cream);
            color: var(--text-dark);
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* Typography */
        h1, h2, h3, h4 {
            font-family: 'Playfair Display', serif;
            font-weight: 500;
        }

        /* Header */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: var(--bg-white);
            border-bottom: 1px solid var(--border-light);
            z-index: 1000;
            transition: var(--transition);
        }

        .header.scrolled {
            box-shadow: var(--shadow-sm);
        }

        .header-top {
            background: var(--accent-green);
            color: white;
            text-align: center;
            padding: 0.5rem;
            font-size: 0.85rem;
            letter-spacing: 0.5px;
        }

        .header-main {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem 4rem;
            max-width: 1600px;
            margin: 0 auto;
        }

        .logo {
            font-family: 'Playfair Display', serif;
            font-size: 1.8rem;
            font-weight: 600;
            color: var(--text-dark);
            text-decoration: none;
            letter-spacing: -0.5px;
        }

        .logo span {
            color: var(--accent-gold);
        }

        .nav-links {
            display: flex;
            gap: 2.5rem;
            list-style: none;
        }

        .nav-links a {
            text-decoration: none;
            color: var(--text-medium);
            font-weight: 500;
            font-size: 0.95rem;
            letter-spacing: 0.3px;
            transition: var(--transition);
            position: relative;
        }

        .nav-links a::after {
            content: '';
            position: absolute;
            bottom: -4px;
            left: 0;
            width: 0;
            height: 1.5px;
            background: var(--accent-gold);
            transition: var(--transition);
        }

        .nav-links a:hover {
            color: var(--text-dark);
        }

        .nav-links a:hover::after {
            width: 100%;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .header-btn {
            background: none;
            border: none;
            cursor: pointer;
            position: relative;
            padding: 0.5rem;
            transition: var(--transition);
        }

        .header-btn svg {
            width: 24px;
            height: 24px;
            stroke: var(--text-dark);
            fill: none;
            stroke-width: 1.5;
        }

        .header-btn:hover svg {
            stroke: var(--accent-gold);
        }

        .cart-count {
            position: absolute;
            top: 0;
            right: 0;
            background: var(--accent-coral);
            color: white;
            font-size: 0.7rem;
            font-weight: 600;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .user-menu {
            position: relative;
        }

        .user-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 0.5rem;
            background: var(--bg-white);
            border: 1px solid var(--border-light);
            border-radius: 12px;
            box-shadow: var(--shadow-lg);
            min-width: 200px;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: var(--transition);
        }

        .user-menu:hover .user-dropdown,
        .user-dropdown.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .user-dropdown a, .user-dropdown button {
            display: block;
            width: 100%;
            padding: 0.85rem 1.25rem;
            text-decoration: none;
            color: var(--text-medium);
            font-size: 0.9rem;
            border: none;
            background: none;
            text-align: left;
            cursor: pointer;
            transition: var(--transition);
        }

        .user-dropdown a:hover, .user-dropdown button:hover {
            background: var(--bg-cream);
            color: var(--text-dark);
        }

        .user-dropdown .divider {
            height: 1px;
            background: var(--border-light);
            margin: 0.5rem 0;
        }

        /* Main Content */
        main {
            padding-top: 140px;
            min-height: 100vh;
        }

        /* Hero Section */
        .hero {
            background: linear-gradient(135deg, #f5f0e8 0%, #e8dfd2 100%);
            padding: 4rem;
            margin: 0 2rem 3rem;
            border-radius: 24px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 4rem;
            align-items: center;
            overflow: hidden;
            position: relative;
        }

        .hero::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -20%;
            width: 600px;
            height: 600px;
            background: radial-gradient(circle, rgba(201, 168, 108, 0.15) 0%, transparent 70%);
            border-radius: 50%;
        }

        .hero-content {
            position: relative;
            z-index: 1;
        }

        .hero-badge {
            display: inline-block;
            background: var(--accent-gold);
            color: white;
            padding: 0.4rem 1rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            letter-spacing: 1px;
            text-transform: uppercase;
            margin-bottom: 1.5rem;
        }

        .hero h1 {
            font-size: 3.5rem;
            line-height: 1.1;
            margin-bottom: 1.5rem;
            color: var(--text-dark);
        }

        .hero p {
            font-size: 1.1rem;
            color: var(--text-medium);
            margin-bottom: 2rem;
            max-width: 400px;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 1rem 2rem;
            border-radius: 50px;
            font-family: 'DM Sans', sans-serif;
            font-size: 0.95rem;
            font-weight: 600;
            text-decoration: none;
            cursor: pointer;
            transition: var(--transition);
            border: none;
        }

        .btn-primary {
            background: var(--text-dark);
            color: white;
        }

        .btn-primary:hover {
            background: var(--accent-gold-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(201, 168, 108, 0.4);
        }

        .btn-secondary {
            background: transparent;
            color: var(--text-dark);
            border: 1.5px solid var(--text-dark);
        }

        .btn-secondary:hover {
            background: var(--text-dark);
            color: white;
        }

        .hero-image {
            position: relative;
            z-index: 1;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .hero-image-placeholder {
            width: 100%;
            max-width: 450px;
            aspect-ratio: 1;
            background: linear-gradient(145deg, #d4c4a8 0%, #c9b896 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 8rem;
            box-shadow: var(--shadow-lg);
        }

        /* Section Headers */
        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 2rem;
            padding: 0 2rem;
        }

        .section-header h2 {
            font-size: 2rem;
        }

        .section-header a {
            color: var(--text-medium);
            text-decoration: none;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: var(--transition);
        }

        .section-header a:hover {
            color: var(--accent-gold);
        }

        /* Products Grid */
        .products-section {
            padding: 2rem;
        }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 2rem;
        }

        .product-card {
            background: var(--bg-white);
            border-radius: 16px;
            overflow: hidden;
            transition: var(--transition);
            cursor: pointer;
            position: relative;
        }

        .product-card:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-lg);
        }

        .product-image {
            aspect-ratio: 1;
            background: linear-gradient(145deg, #f0ebe3 0%, #e8e0d5 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 5rem;
            position: relative;
            overflow: hidden;
        }

        .product-badge {
            position: absolute;
            top: 1rem;
            left: 1rem;
            background: var(--accent-coral);
            color: white;
            padding: 0.3rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .product-actions {
            position: absolute;
            top: 1rem;
            right: 1rem;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            opacity: 0;
            transform: translateX(10px);
            transition: var(--transition);
        }

        .product-card:hover .product-actions {
            opacity: 1;
            transform: translateX(0);
        }

        .product-action-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--bg-white);
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow-sm);
            transition: var(--transition);
        }

        .product-action-btn svg {
            width: 18px;
            height: 18px;
            stroke: var(--text-dark);
            fill: none;
            stroke-width: 1.5;
        }

        .product-action-btn:hover {
            background: var(--accent-gold);
        }

        .product-action-btn:hover svg {
            stroke: white;
        }

        .product-info {
            padding: 1.25rem;
        }

        .product-category {
            font-size: 0.8rem;
            color: var(--text-light);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 0.5rem;
        }

        .product-name {
            font-family: 'Playfair Display', serif;
            font-size: 1.1rem;
            font-weight: 500;
            margin-bottom: 0.75rem;
            color: var(--text-dark);
        }

        .product-price {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .current-price {
            font-size: 1.15rem;
            font-weight: 600;
            color: var(--text-dark);
        }

        .original-price {
            font-size: 0.9rem;
            color: var(--text-light);
            text-decoration: line-through;
        }

        .product-stock {
            font-size: 0.8rem;
            color: var(--accent-green);
            margin-top: 0.5rem;
        }

        .product-stock.low {
            color: var(--accent-coral);
        }

        /* Cart Sidebar */
        .cart-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
        }

        .cart-overlay.open {
            opacity: 1;
            visibility: visible;
        }

        .cart-sidebar {
            position: fixed;
            top: 0;
            right: 0;
            bottom: 0;
            width: 420px;
            max-width: 100%;
            background: var(--bg-white);
            z-index: 2001;
            transform: translateX(100%);
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            flex-direction: column;
        }

        .cart-overlay.open .cart-sidebar {
            transform: translateX(0);
        }

        .cart-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-light);
        }

        .cart-header h3 {
            font-size: 1.3rem;
        }

        .cart-close {
            background: none;
            border: none;
            cursor: pointer;
            padding: 0.5rem;
        }

        .cart-close svg {
            width: 24px;
            height: 24px;
            stroke: var(--text-dark);
        }

        .cart-items {
            flex: 1;
            overflow-y: auto;
            padding: 1.5rem;
        }

        .cart-empty {
            text-align: center;
            padding: 3rem 1rem;
            color: var(--text-light);
        }

        .cart-empty svg {
            width: 80px;
            height: 80px;
            stroke: var(--border-light);
            margin-bottom: 1rem;
        }

        .cart-item {
            display: flex;
            gap: 1rem;
            padding: 1rem 0;
            border-bottom: 1px solid var(--border-light);
        }

        .cart-item-image {
            width: 80px;
            height: 80px;
            background: linear-gradient(145deg, #f0ebe3 0%, #e8e0d5 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            flex-shrink: 0;
        }

        .cart-item-details {
            flex: 1;
        }

        .cart-item-name {
            font-weight: 500;
            margin-bottom: 0.25rem;
        }

        .cart-item-price {
            color: var(--text-medium);
            font-size: 0.9rem;
        }

        .cart-item-quantity {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-top: 0.75rem;
        }

        .qty-btn {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            border: 1px solid var(--border-light);
            background: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .qty-btn:hover {
            background: var(--bg-cream);
        }

        .cart-item-remove {
            background: none;
            border: none;
            color: var(--text-light);
            cursor: pointer;
            font-size: 0.85rem;
            transition: var(--transition);
        }

        .cart-item-remove:hover {
            color: var(--accent-coral);
        }

        .cart-footer {
            padding: 1.5rem;
            border-top: 1px solid var(--border-light);
            background: var(--bg-cream);
        }

        .cart-subtotal {
            display: flex;
            justify-content: space-between;
            margin-bottom: 1rem;
        }

        .cart-subtotal span:last-child {
            font-weight: 600;
            font-size: 1.2rem;
        }

        .cart-checkout-btn {
            width: 100%;
            padding: 1rem;
            background: var(--text-dark);
            color: white;
            border: none;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
        }

        .cart-checkout-btn:hover {
            background: var(--accent-gold-dark);
        }

        /* Auth Modal */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.6);
            z-index: 3000;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
            padding: 1rem;
        }

        .modal-overlay.open {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background: var(--bg-white);
            border-radius: 24px;
            width: 100%;
            max-width: 440px;
            transform: scale(0.9) translateY(20px);
            transition: var(--transition);
            overflow: hidden;
        }

        .modal-overlay.open .modal {
            transform: scale(1) translateY(0);
        }

        .modal-header {
            padding: 2rem 2rem 1rem;
            text-align: center;
        }

        .modal-header h3 {
            font-size: 1.75rem;
            margin-bottom: 0.5rem;
        }

        .modal-header p {
            color: var(--text-medium);
            font-size: 0.95rem;
        }

        .modal-tabs {
            display: flex;
            padding: 0 2rem;
            gap: 1rem;
        }

        .modal-tab {
            flex: 1;
            padding: 0.75rem;
            border: none;
            background: none;
            font-family: 'DM Sans', sans-serif;
            font-size: 1rem;
            font-weight: 500;
            color: var(--text-light);
            cursor: pointer;
            position: relative;
            transition: var(--transition);
        }

        .modal-tab.active {
            color: var(--text-dark);
        }

        .modal-tab::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--accent-gold);
            transform: scaleX(0);
            transition: var(--transition);
        }

        .modal-tab.active::after {
            transform: scaleX(1);
        }

        .modal-body {
            padding: 2rem;
        }

        .auth-form {
            display: none;
        }

        .auth-form.active {
            display: block;
        }

        .form-group {
            margin-bottom: 1.25rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            font-size: 0.9rem;
            color: var(--text-dark);
        }

        .form-group input {
            width: 100%;
            padding: 0.9rem 1rem;
            border: 1.5px solid var(--border-light);
            border-radius: 12px;
            font-family: 'DM Sans', sans-serif;
            font-size: 1rem;
            transition: var(--transition);
        }

        .form-group input:focus {
            outline: none;
            border-color: var(--accent-gold);
            box-shadow: 0 0 0 3px rgba(201, 168, 108, 0.15);
        }

        .form-submit {
            width: 100%;
            padding: 1rem;
            background: var(--text-dark);
            color: white;
            border: none;
            border-radius: 50px;
            font-family: 'DM Sans', sans-serif;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            margin-top: 0.5rem;
        }

        .form-submit:hover {
            background: var(--accent-gold-dark);
        }

        .form-submit:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .modal-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            cursor: pointer;
            padding: 0.5rem;
        }

        .modal-close svg {
            width: 24px;
            height: 24px;
            stroke: var(--text-medium);
        }

        /* Product Modal */
        .product-modal .modal {
            max-width: 900px;
            display: grid;
            grid-template-columns: 1fr 1fr;
        }

        .product-modal-image {
            background: linear-gradient(145deg, #f0ebe3 0%, #e8e0d5 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 8rem;
            min-height: 400px;
        }

        .product-modal-content {
            padding: 2rem;
            display: flex;
            flex-direction: column;
        }

        .product-modal-content h2 {
            font-size: 1.75rem;
            margin-bottom: 1rem;
        }

        .product-modal-price {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 1rem;
        }

        .product-modal-description {
            color: var(--text-medium);
            line-height: 1.7;
            margin-bottom: 1.5rem;
            flex: 1;
        }

        .product-modal-stock {
            margin-bottom: 1.5rem;
            padding: 0.75rem 1rem;
            background: var(--bg-cream);
            border-radius: 8px;
            font-size: 0.9rem;
        }

        .add-to-cart-form {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .quantity-selector {
            display: flex;
            align-items: center;
            border: 1.5px solid var(--border-light);
            border-radius: 50px;
            overflow: hidden;
        }

        .quantity-selector button {
            width: 44px;
            height: 44px;
            border: none;
            background: none;
            cursor: pointer;
            font-size: 1.2rem;
            transition: var(--transition);
        }

        .quantity-selector button:hover {
            background: var(--bg-cream);
        }

        .quantity-selector input {
            width: 50px;
            text-align: center;
            border: none;
            font-family: 'DM Sans', sans-serif;
            font-size: 1rem;
            font-weight: 500;
        }

        .quantity-selector input:focus {
            outline: none;
        }

        .add-to-cart-btn {
            flex: 1;
            padding: 1rem 2rem;
            background: var(--text-dark);
            color: white;
            border: none;
            border-radius: 50px;
            font-family: 'DM Sans', sans-serif;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
        }

        .add-to-cart-btn:hover {
            background: var(--accent-gold-dark);
        }

        /* Toast */
        .toast-container {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            z-index: 4000;
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .toast {
            background: var(--text-dark);
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 12px;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            box-shadow: var(--shadow-lg);
            animation: slideInRight 0.3s ease-out;
            min-width: 280px;
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(100%);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .toast.success {
            background: var(--accent-green);
        }

        .toast.error {
            background: var(--accent-coral);
        }

        .toast-icon {
            font-size: 1.25rem;
        }

        /* Loading */
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--border-light);
            border-top-color: var(--accent-gold);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin: 2rem auto;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .products-loading {
            grid-column: 1 / -1;
            text-align: center;
            padding: 4rem;
        }

        /* Empty State */
        .empty-state {
            grid-column: 1 / -1;
            text-align: center;
            padding: 4rem 2rem;
            color: var(--text-light);
        }

        .empty-state svg {
            width: 100px;
            height: 100px;
            stroke: var(--border-light);
            margin-bottom: 1.5rem;
        }

        .empty-state h3 {
            font-size: 1.5rem;
            color: var(--text-medium);
            margin-bottom: 0.5rem;
        }

        /* Footer */
        footer {
            background: var(--text-dark);
            color: white;
            padding: 4rem 2rem 2rem;
            margin-top: 4rem;
        }

        .footer-content {
            max-width: 1400px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr;
            gap: 3rem;
        }

        .footer-brand h4 {
            font-size: 1.5rem;
            margin-bottom: 1rem;
            color: white;
        }

        .footer-brand p {
            color: rgba(255,255,255,0.7);
            line-height: 1.8;
        }

        .footer-column h5 {
            font-family: 'DM Sans', sans-serif;
            font-weight: 600;
            margin-bottom: 1.25rem;
            font-size: 0.95rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .footer-column ul {
            list-style: none;
        }

        .footer-column li {
            margin-bottom: 0.75rem;
        }

        .footer-column a {
            color: rgba(255,255,255,0.7);
            text-decoration: none;
            transition: var(--transition);
        }

        .footer-column a:hover {
            color: var(--accent-gold);
        }

        .footer-bottom {
            border-top: 1px solid rgba(255,255,255,0.1);
            margin-top: 3rem;
            padding-top: 2rem;
            text-align: center;
            color: rgba(255,255,255,0.5);
            font-size: 0.9rem;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .header-main {
                padding: 1rem 2rem;
            }

            .nav-links {
                display: none;
            }

            .hero {
                grid-template-columns: 1fr;
                text-align: center;
                padding: 3rem 2rem;
            }

            .hero p {
                max-width: 100%;
            }

            .hero-image {
                order: -1;
            }

            .hero-image-placeholder {
                max-width: 250px;
                font-size: 5rem;
            }

            .product-modal .modal {
                grid-template-columns: 1fr;
                max-height: 90vh;
                overflow-y: auto;
            }

            .footer-content {
                grid-template-columns: 1fr 1fr;
            }
        }

        @media (max-width: 640px) {
            .hero h1 {
                font-size: 2.25rem;
            }

            .products-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 1rem;
            }

            .product-info {
                padding: 1rem;
            }

            .product-name {
                font-size: 0.95rem;
            }

            .cart-sidebar {
                width: 100%;
            }

            .footer-content {
                grid-template-columns: 1fr;
            }
        }

        /* User welcome */
        .user-welcome {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
            color: var(--text-medium);
        }

        .user-welcome strong {
            color: var(--text-dark);
        }

        /* Pagination */
        .pagination-btn:hover:not(:disabled) {
            background: var(--bg-cream);
            border-color: var(--accent-gold);
        }

        .pagination-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header" id="header">
        <div class="header-top">
            Free shipping on orders over Rp 500.000 ‚ú®
        </div>
        <div class="header-main">
            <a href="#" class="logo">Blibli<span>Store</span></a>
            
            <ul class="nav-links">
                <li><a href="#" onclick="showAllProducts()">All Products</a></li>
                <li><a href="#">New Arrivals</a></li>
                <li><a href="#">Best Sellers</a></li>
                <li><a href="#">Sale</a></li>
            </ul>

            <div class="header-actions">
                <button class="header-btn" onclick="openCart()" aria-label="Cart">
                    <svg viewBox="0 0 24 24"><path d="M6 2L3 6v14a2 2 0 002 2h14a2 2 0 002-2V6l-3-4z"/><line x1="3" y1="6" x2="21" y2="6"/><path d="M16 10a4 4 0 01-8 0"/></svg>
                    <span class="cart-count" id="cartCount">0</span>
                </button>
                
                <div class="user-menu">
                    <button class="header-btn" aria-label="Account" onclick="toggleUserMenu()">
                        <svg viewBox="0 0 24 24"><path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                    </button>
                    <div class="user-dropdown" id="userDropdown">
                        <div id="loggedOutMenu">
                            <a href="#" onclick="openAuthModal('login')">Sign In</a>
                            <a href="#" onclick="openAuthModal('register')">Create Account</a>
                        </div>
                        <div id="loggedInMenu" style="display: none;">
                            <div class="user-welcome" style="padding: 0.85rem 1.25rem;">
                                Welcome, <strong id="userEmail"></strong>
                            </div>
                            <div class="divider"></div>
                            <button onclick="logout()">Sign Out</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main>
        <!-- Hero Section -->
        <section class="hero">
            <div class="hero-content">
                <span class="hero-badge">New Collection</span>
                <h1>Discover Premium Quality Products</h1>
                <p>Explore our curated collection of exceptional products designed to elevate your everyday experience.</p>
                <a href="#products" class="btn btn-primary" onclick="showAllProducts()">
                    Shop Now
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
                </a>
            </div>
            <div class="hero-image">
                <div class="hero-image-placeholder">üõçÔ∏è</div>
            </div>
        </section>

        <!-- Products Section -->
        <section class="products-section" id="products">
            <div class="section-header">
                <h2>Featured Products</h2>
            </div>

            <!-- Search and Filters -->
            <div class="search-filters" style="padding: 0 2rem; margin-bottom: 2rem;">
                <div style="background: var(--bg-white); border-radius: 16px; padding: 1.5rem; border: 1px solid var(--border-light);">
                    <div style="display: grid; grid-template-columns: 2fr 1fr 1fr auto; gap: 1rem; align-items: end;">
                        <div class="form-group" style="margin-bottom: 0;">
                            <label for="searchInput" style="display: block; margin-bottom: 0.5rem; font-weight: 500; font-size: 0.9rem; color: var(--text-dark);">Search Products</label>
                            <input type="text" id="searchInput" placeholder="Search by name..." style="width: 100%; padding: 0.75rem 1rem; border: 1.5px solid var(--border-light); border-radius: 12px; font-family: 'DM Sans', sans-serif; font-size: 1rem;" onkeypress="if(event.key==='Enter') searchProducts()">
                        </div>
                        <div class="form-group" style="margin-bottom: 0;">
                            <label for="minPriceFilter" style="display: block; margin-bottom: 0.5rem; font-weight: 500; font-size: 0.9rem; color: var(--text-dark);">Min Price</label>
                            <input type="number" id="minPriceFilter" placeholder="0" step="1000" style="width: 100%; padding: 0.75rem 1rem; border: 1.5px solid var(--border-light); border-radius: 12px; font-family: 'DM Sans', sans-serif; font-size: 1rem;">
                        </div>
                        <div class="form-group" style="margin-bottom: 0;">
                            <label for="maxPriceFilter" style="display: block; margin-bottom: 0.5rem; font-weight: 500; font-size: 0.9rem; color: var(--text-dark);">Max Price</label>
                            <input type="number" id="maxPriceFilter" placeholder="999999" step="1000" style="width: 100%; padding: 0.75rem 1rem; border: 1.5px solid var(--border-light); border-radius: 12px; font-family: 'DM Sans', sans-serif; font-size: 1rem;">
                        </div>
                        <button onclick="searchProducts()" class="btn btn-primary" style="width: auto; padding: 0.85rem 2rem; margin-bottom: 0;">
                            Search
                        </button>
                    </div>
                    <div style="margin-top: 1rem; display: flex; gap: 0.5rem; align-items: center;">
                        <button onclick="clearFilters()" style="background: none; border: none; color: var(--text-medium); font-size: 0.9rem; cursor: pointer; text-decoration: underline;">Clear Filters</button>
                        <span style="color: var(--text-light); font-size: 0.85rem;" id="resultCount"></span>
                    </div>
                </div>
            </div>

            <div class="products-grid" id="productsGrid">
                <div class="products-loading">
                    <div class="loading-spinner"></div>
                    <p>Loading products...</p>
                </div>
            </div>

            <!-- Pagination -->
            <div id="paginationContainer" style="display: none; padding: 2rem; text-align: center;">
                <div style="display: inline-flex; gap: 0.5rem; align-items: center; background: var(--bg-white); padding: 0.75rem 1rem; border-radius: 12px; border: 1px solid var(--border-light);">
                    <button onclick="goToPrevPage()" id="prevBtn" class="pagination-btn" style="padding: 0.5rem 1rem; border: 1px solid var(--border-light); border-radius: 8px; background: var(--bg-white); cursor: pointer; font-family: 'DM Sans', sans-serif; font-weight: 500; transition: var(--transition);">‚Üê Previous</button>
                    
                    <div id="pageNumbers" style="display: flex; gap: 0.25rem; margin: 0 0.5rem;"></div>
                    
                    <button onclick="goToNextPage()" id="nextBtn" class="pagination-btn" style="padding: 0.5rem 1rem; border: 1px solid var(--border-light); border-radius: 8px; background: var(--bg-white); cursor: pointer; font-family: 'DM Sans', sans-serif; font-weight: 500; transition: var(--transition);">Next ‚Üí</button>
                </div>
                <div style="margin-top: 1rem; color: var(--text-medium); font-size: 0.9rem;">
                    Page <span id="currentPageDisplay">1</span> of <span id="totalPagesDisplay">1</span>
                </div>
            </div>
        </section>
    </main>

    <!-- Cart Sidebar -->
    <div class="cart-overlay" id="cartOverlay" onclick="closeCart()">
        <div class="cart-sidebar" onclick="event.stopPropagation()">
            <div class="cart-header">
                <h3>Shopping Cart</h3>
                <button class="cart-close" onclick="closeCart()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
                </button>
            </div>
            <div class="cart-items" id="cartItems">
                <div class="cart-empty">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M6 2L3 6v14a2 2 0 002 2h14a2 2 0 002-2V6l-3-4z"/><line x1="3" y1="6" x2="21" y2="6"/><path d="M16 10a4 4 0 01-8 0"/></svg>
                    <p>Your cart is empty</p>
                    <button class="btn btn-secondary" style="margin-top: 1rem;" onclick="closeCart()">Continue Shopping</button>
                </div>
            </div>
            <div class="cart-footer" id="cartFooter" style="display: none;">
                <div class="cart-subtotal">
                    <span>Subtotal</span>
                    <span id="cartTotal">Rp 0</span>
                </div>
                <button onclick="clearCart()" style="width: 100%; padding: 0.75rem; background: transparent; color: var(--accent-coral); border: 1.5px solid var(--accent-coral); border-radius: 50px; font-family: 'DM Sans', sans-serif; font-size: 0.9rem; font-weight: 600; cursor: pointer; transition: var(--transition); margin-bottom: 0.75rem;" onmouseover="this.style.background='var(--accent-coral)'; this.style.color='white'" onmouseout="this.style.background='transparent'; this.style.color='var(--accent-coral)'">Clear Cart</button>
                <button class="cart-checkout-btn" onclick="checkout()">Proceed to Checkout</button>
            </div>
        </div>
    </div>

    <!-- Auth Modal -->
    <div class="modal-overlay" id="authModal">
        <div class="modal" style="position: relative;">
            <button class="modal-close" onclick="closeAuthModal()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
            </button>
            <div class="modal-header">
                <h3>Welcome</h3>
                <p>Sign in or create an account to continue</p>
            </div>
            <div class="modal-tabs">
                <button class="modal-tab active" onclick="switchAuthTab('login')">Sign In</button>
                <button class="modal-tab" onclick="switchAuthTab('register')">Register</button>
            </div>
            <div class="modal-body">
                <!-- Login Form -->
                <form class="auth-form active" id="loginForm" onsubmit="handleLogin(event)">
                    <div class="form-group">
                        <label for="loginEmail">Email Address</label>
                        <input type="email" id="loginEmail" placeholder="you@example.com" required>
                    </div>
                    <div class="form-group">
                        <label for="loginPassword">Password</label>
                        <input type="password" id="loginPassword" placeholder="Enter your password" required>
                    </div>
                    <button type="submit" class="form-submit" id="loginBtn">Sign In</button>
                </form>

                <!-- Register Form -->
                <form class="auth-form" id="registerForm" onsubmit="handleRegister(event)">
                    <div class="form-group">
                        <label for="registerEmail">Email Address</label>
                        <input type="email" id="registerEmail" placeholder="you@example.com" required>
                    </div>
                    <div class="form-group">
                        <label for="registerPassword">Password</label>
                        <input type="password" id="registerPassword" placeholder="Create a password" required>
                    </div>
                    <button type="submit" class="form-submit" id="registerBtn">Create Account</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Product Detail Modal -->
    <div class="modal-overlay product-modal" id="productModal">
        <div class="modal">
            <button class="modal-close" onclick="closeProductModal()" style="z-index: 10;">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
            </button>
            <div class="product-modal-image" id="productModalImage">üì¶</div>
            <div class="product-modal-content">
                <h2 id="productModalName">Product Name</h2>
                <div class="product-modal-price" id="productModalPrice">Rp 0</div>
                <p class="product-modal-description" id="productModalDescription">Product description goes here...</p>
                <div class="product-modal-stock" id="productModalStock">In Stock: 0</div>
                <div class="add-to-cart-form">
                    <div class="quantity-selector">
                        <button type="button" onclick="decreaseQuantity()">‚àí</button>
                        <input type="number" id="productQuantity" value="1" min="1">
                        <button type="button" onclick="increaseQuantity()">+</button>
                    </div>
                    <button class="add-to-cart-btn" onclick="addToCartFromModal()">Add to Cart</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Footer -->
    <footer>
        <div class="footer-content">
            <div class="footer-brand">
                <h4>BlibliStore</h4>
                <p>Your premium destination for quality products. We curate the finest items to bring joy and convenience to your everyday life.</p>
            </div>
            <div class="footer-column">
                <h5>Shop</h5>
                <ul>
                    <li><a href="#">All Products</a></li>
                    <li><a href="#">New Arrivals</a></li>
                    <li><a href="#">Best Sellers</a></li>
                    <li><a href="#">Sale</a></li>
                </ul>
            </div>
            <div class="footer-column">
                <h5>Support</h5>
                <ul>
                    <li><a href="#">Contact Us</a></li>
                    <li><a href="#">FAQs</a></li>
                    <li><a href="#">Shipping</a></li>
                    <li><a href="#">Returns</a></li>
                </ul>
            </div>
            <div class="footer-column">
                <h5>Company</h5>
                <ul>
                    <li><a href="#">About Us</a></li>
                    <li><a href="#">Careers</a></li>
                    <li><a href="#">Privacy Policy</a></li>
                    <li><a href="#">Terms of Service</a></li>
                </ul>
            </div>
        </div>
        <div class="footer-bottom">
            <p>¬© 2025 BlibliStore. All rights reserved.</p>
        </div>
    </footer>

    <script>
        // Configuration
        const API_BASE_URL = 'http://localhost:7070';

        // State
        let currentUser = JSON.parse(localStorage.getItem('user')) || null;
        let authToken = localStorage.getItem('authToken') || '';
        let products = [];
        let cart = { items: [] };
        let selectedProduct = null;
        
        // Pagination state
        let currentPage = 0;
        let pageSize = 12;
        let totalPages = 1;
        let totalProducts = 0;

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            updateAuthUI();
            loadProducts();
            loadCart();

            // Header scroll effect
            window.addEventListener('scroll', () => {
                document.getElementById('header').classList.toggle('scrolled', window.scrollY > 50);
            });
        });

        // API Helper
        async function apiCall(method, endpoint, body = null, headers = {}) {
            const defaultHeaders = {
                'Content-Type': 'application/json',
            };

            if (authToken) {
                defaultHeaders['Authorization'] = `Bearer ${authToken}`;
            }

            const options = {
                method,
                headers: { ...defaultHeaders, ...headers },
            };

            if (body) {
                options.body = JSON.stringify(body);
            }

            try {
                const response = await fetch(`${API_BASE_URL}${endpoint}`, options);
                const data = await response.json();
                return { data, status: response.status, ok: response.ok };
            } catch (error) {
                console.error('API Error:', error);
                throw error;
            }
        }

        // Toast Notifications
        function showToast(message, type = 'success') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                <span class="toast-icon">${type === 'success' ? '‚úì' : type === 'error' ? '‚úï' : '‚Ñπ'}</span>
                <span>${message}</span>
            `;
            container.appendChild(toast);

            setTimeout(() => {
                toast.style.animation = 'slideInRight 0.3s ease-out reverse';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // Format Price
        function formatPrice(price) {
            return new Intl.NumberFormat('id-ID', {
                style: 'currency',
                currency: 'IDR',
                minimumFractionDigits: 0
            }).format(price);
        }

        // Products
        async function loadProducts(page = 0) {
            const grid = document.getElementById('productsGrid');
            grid.innerHTML = `
                <div class="products-loading">
                    <div class="loading-spinner"></div>
                    <p>Loading products...</p>
                </div>
            `;

            try {
                // Build search request
                const searchRequest = {
                    page: page,
                    size: pageSize,
                    search: document.getElementById('searchInput')?.value || '',
                };

                const minPrice = document.getElementById('minPriceFilter')?.value;
                const maxPrice = document.getElementById('maxPriceFilter')?.value;
                
                if (minPrice) searchRequest.minPrice = parseFloat(minPrice);
                if (maxPrice) searchRequest.maxPrice = parseFloat(maxPrice);

                const { data, ok, status } = await apiCall('POST', '/product-service/products/search', searchRequest);
                
                if (ok && data.data) {
                    // Backend now returns paginated response
                    const pagedResponse = data.data;
                    products = pagedResponse.products;
                    currentPage = pagedResponse.currentPage;
                    totalProducts = pagedResponse.totalElements;
                    totalPages = pagedResponse.totalPages || 1;
                    
                    renderProducts();
                    updatePagination();
                    updateResultCount();
                } else {
                    const errorMessage = data?.message || `Error ${status}`;
                    grid.innerHTML = `
                        <div class="empty-state">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                                <line x1="3" y1="9" x2="21" y2="9"/>
                                <line x1="9" y1="21" x2="9" y2="9"/>
                            </svg>
                            <h3>Failed to Load Products</h3>
                            <p>${errorMessage}</p>
                            <button class="btn btn-secondary" style="margin-top: 1rem;" onclick="loadProducts()">Try Again</button>
                        </div>
                    `;
                    document.getElementById('paginationContainer').style.display = 'none';
                }
            } catch (error) {
                grid.innerHTML = `
                    <div class="empty-state">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <circle cx="12" cy="12" r="10"/>
                            <line x1="12" y1="8" x2="12" y2="12"/>
                            <line x1="12" y1="16" x2="12.01" y2="16"/>
                        </svg>
                        <h3>Connection Error</h3>
                        <p>Could not connect to the server at ${API_BASE_URL}</p>
                        <button class="btn btn-secondary" style="margin-top: 1rem;" onclick="loadProducts()">Try Again</button>
                    </div>
                `;
                document.getElementById('paginationContainer').style.display = 'none';
            }
        }

        function searchProducts() {
            currentPage = 0;
            loadProducts(0);
        }

        function clearFilters() {
            document.getElementById('searchInput').value = '';
            document.getElementById('minPriceFilter').value = '';
            document.getElementById('maxPriceFilter').value = '';
            searchProducts();
        }

        function goToPage(page) {
            if (page < 0 || page >= totalPages) return;
            loadProducts(page);
            window.scrollTo({ top: document.getElementById('products').offsetTop - 150, behavior: 'smooth' });
        }

        function goToPrevPage() {
            if (currentPage > 0) {
                goToPage(currentPage - 1);
            }
        }

        function goToNextPage() {
            if (currentPage < totalPages - 1) {
                goToPage(currentPage + 1);
            }
        }

        function updatePagination() {
            const container = document.getElementById('paginationContainer');
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const pageNumbers = document.getElementById('pageNumbers');

            if (totalPages <= 1) {
                container.style.display = 'none';
                return;
            }

            container.style.display = 'block';
            
            // Update buttons
            prevBtn.disabled = currentPage === 0;
            nextBtn.disabled = currentPage >= totalPages - 1;
            
            // Update button styling
            if (prevBtn.disabled) {
                prevBtn.style.opacity = '0.5';
                prevBtn.style.cursor = 'not-allowed';
            } else {
                prevBtn.style.opacity = '1';
                prevBtn.style.cursor = 'pointer';
            }
            
            if (nextBtn.disabled) {
                nextBtn.style.opacity = '0.5';
                nextBtn.style.cursor = 'not-allowed';
            } else {
                nextBtn.style.opacity = '1';
                nextBtn.style.cursor = 'pointer';
            }
            
            // Generate page numbers
            let pages = [];
            const maxVisible = 5;
            
            if (totalPages <= maxVisible) {
                for (let i = 0; i < totalPages; i++) {
                    pages.push(i);
                }
            } else {
                if (currentPage < 3) {
                    pages = [0, 1, 2, 3, '...', totalPages - 1];
                } else if (currentPage > totalPages - 4) {
                    pages = [0, '...', totalPages - 4, totalPages - 3, totalPages - 2, totalPages - 1];
                } else {
                    pages = [0, '...', currentPage - 1, currentPage, currentPage + 1, '...', totalPages - 1];
                }
            }
            
            pageNumbers.innerHTML = pages.map(page => {
                if (page === '...') {
                    return '<span style="padding: 0.5rem;">...</span>';
                }
                const isActive = page === currentPage;
                return `
                    <button 
                        onclick="goToPage(${page})" 
                        style="
                            min-width: 40px;
                            padding: 0.5rem;
                            border: 1px solid ${isActive ? 'var(--accent-gold)' : 'var(--border-light)'};
                            border-radius: 8px;
                            background: ${isActive ? 'var(--accent-gold)' : 'var(--bg-white)'};
                            color: ${isActive ? 'white' : 'var(--text-dark)'};
                            cursor: pointer;
                            font-family: 'DM Sans', sans-serif;
                            font-weight: ${isActive ? '600' : '500'};
                            transition: var(--transition);
                        "
                        ${isActive ? 'disabled' : ''}
                    >${page + 1}</button>
                `;
            }).join('');
            
            document.getElementById('currentPageDisplay').textContent = currentPage + 1;
            document.getElementById('totalPagesDisplay').textContent = totalPages;
        }

        function updateResultCount() {
            const resultCount = document.getElementById('resultCount');
            if (totalProducts > 0) {
                const start = currentPage * pageSize + 1;
                const end = Math.min((currentPage + 1) * pageSize, totalProducts);
                resultCount.textContent = `Showing ${start}-${end} of ${totalProducts} product${totalProducts !== 1 ? 's' : ''}`;
            } else {
                resultCount.textContent = '';
            }
        }

        function renderProducts() {
            const grid = document.getElementById('productsGrid');
            
            if (products.length === 0) {
                grid.innerHTML = `
                    <div class="empty-state">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                            <line x1="3" y1="9" x2="21" y2="9"/>
                            <line x1="9" y1="21" x2="9" y2="9"/>
                        </svg>
                        <h3>No Products Found</h3>
                        <p>Try adjusting your search or filters</p>
                    </div>
                `;
                document.getElementById('paginationContainer').style.display = 'none';
                return;
            }

            const emojis = ['üëú', 'üëü', '‚åö', 'üíé', 'üéß', 'üì±', 'üíª', 'üéÆ', 'üì∑', 'üï∂Ô∏è'];

            // Backend already returns paginated products
            grid.innerHTML = products.map((product, index) => `
                <div class="product-card" onclick="openProductModal('${product.id}')">
                    <div class="product-image">
                        ${emojis[index % emojis.length]}
                        ${product.stock < 10 ? '<span class="product-badge">Low Stock</span>' : ''}
                        <div class="product-actions">
                            <button class="product-action-btn" onclick="event.stopPropagation(); quickAddToCart('${product.id}')" title="Add to Cart">
                                <svg viewBox="0 0 24 24"><path d="M6 2L3 6v14a2 2 0 002 2h14a2 2 0 002-2V6l-3-4z"/><line x1="3" y1="6" x2="21" y2="6"/><path d="M16 10a4 4 0 01-8 0"/></svg>
                            </button>
                        </div>
                    </div>
                    <div class="product-info">
                        <p class="product-category">Premium Collection</p>
                        <h3 class="product-name">${product.name}</h3>
                        <div class="product-price">
                            <span class="current-price">${formatPrice(product.price)}</span>
                        </div>
                        <p class="product-stock ${product.stock < 10 ? 'low' : ''}">${product.stock} in stock</p>
                    </div>
                </div>
            `).join('');
        }

        function showAllProducts() {
            document.getElementById('products').scrollIntoView({ behavior: 'smooth' });
        }

        // Product Modal
        function openProductModal(productId) {
            selectedProduct = products.find(p => p.id === productId);
            if (!selectedProduct) return;

            const emojis = ['üëú', 'üëü', '‚åö', 'üíé', 'üéß', 'üì±', 'üíª', 'üéÆ', 'üì∑', 'üï∂Ô∏è'];
            const index = products.indexOf(selectedProduct);

            document.getElementById('productModalImage').textContent = emojis[index % emojis.length];
            document.getElementById('productModalName').textContent = selectedProduct.name;
            document.getElementById('productModalPrice').textContent = formatPrice(selectedProduct.price);
            document.getElementById('productModalDescription').textContent = selectedProduct.description || 'A premium quality product designed to meet your needs. Experience excellence with every use.';
            document.getElementById('productModalStock').textContent = `In Stock: ${selectedProduct.stock} units`;
            document.getElementById('productQuantity').value = 1;
            document.getElementById('productQuantity').max = selectedProduct.stock;

            document.getElementById('productModal').classList.add('open');
            document.body.style.overflow = 'hidden';
        }

        function closeProductModal() {
            document.getElementById('productModal').classList.remove('open');
            document.body.style.overflow = '';
            selectedProduct = null;
        }

        function increaseQuantity() {
            const input = document.getElementById('productQuantity');
            const max = selectedProduct ? selectedProduct.stock : 99;
            if (parseInt(input.value) < max) {
                input.value = parseInt(input.value) + 1;
            }
        }

        function decreaseQuantity() {
            const input = document.getElementById('productQuantity');
            if (parseInt(input.value) > 1) {
                input.value = parseInt(input.value) - 1;
            }
        }

        // Cart
        function getUserId() {
            // Use current user's ID or default to 1
            return currentUser?.id || 1;
        }

        async function loadCart() {
            try {
                const { data, ok, status } = await apiCall('GET', '/cart', null, {
                    'X-User-Id': getUserId()
                });

                if (ok && data.data) {
                    cart = data.data;
                    updateCartUI();
                } else if (status === 401) {
                    // User not authenticated, clear cart
                    cart = { items: [] };
                    updateCartUI();
                }
            } catch (error) {
                console.log('Could not load cart:', error);
            }
        }

        function updateCartUI() {
            const count = cart.items ? cart.items.reduce((sum, item) => sum + item.quantity, 0) : 0;
            document.getElementById('cartCount').textContent = count;
            
            const cartItems = document.getElementById('cartItems');
            const cartFooter = document.getElementById('cartFooter');

            if (!cart.items || cart.items.length === 0) {
                cartItems.innerHTML = `
                    <div class="cart-empty">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M6 2L3 6v14a2 2 0 002 2h14a2 2 0 002-2V6l-3-4z"/><line x1="3" y1="6" x2="21" y2="6"/><path d="M16 10a4 4 0 01-8 0"/></svg>
                        <p>Your cart is empty</p>
                        <button class="btn btn-secondary" style="margin-top: 1rem;" onclick="closeCart()">Continue Shopping</button>
                    </div>
                `;
                cartFooter.style.display = 'none';
                return;
            }

            const emojis = ['üëú', 'üëü', '‚åö', 'üíé', 'üéß', 'üì±', 'üíª', 'üéÆ', 'üì∑', 'üï∂Ô∏è'];

            cartItems.innerHTML = cart.items.map((item, index) => {
                return `
                    <div class="cart-item">
                        <div class="cart-item-image">${emojis[index % emojis.length]}</div>
                        <div class="cart-item-details">
                            <p class="cart-item-name">${item.productName}</p>
                            <p class="cart-item-price">${formatPrice(item.price)} √ó ${item.quantity}</p>
                            <div class="cart-item-quantity">
                                <span style="font-weight: 600; color: var(--text-dark);">Subtotal: ${formatPrice(item.price * item.quantity)}</span>
                            </div>
                            <button class="cart-item-remove" onclick="removeCartItem(${item.id})" style="margin-top: 0.5rem;">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 0.25rem;">
                                    <polyline points="3 6 5 6 21 6"/>
                                    <path d="M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/>
                                    <line x1="10" y1="11" x2="10" y2="17"/>
                                    <line x1="14" y1="11" x2="14" y2="17"/>
                                </svg>
                                Remove
                            </button>
                        </div>
                    </div>
                `;
            }).join('');

            // Calculate total
            const total = cart.items.reduce((sum, item) => {
                return sum + (item.price * item.quantity);
            }, 0);

            document.getElementById('cartTotal').textContent = formatPrice(total);
            cartFooter.style.display = 'block';
        }

        async function quickAddToCart(productId) {
            await addToCart(productId, 1);
        }

        async function addToCartFromModal() {
            if (!selectedProduct) return;
            const quantity = parseInt(document.getElementById('productQuantity').value);
            await addToCart(selectedProduct.id, quantity);
            closeProductModal();
        }

        async function addToCart(productId, quantity) {
            try {
                // Find the product to get all details
                const product = products.find(p => p.id === productId);
                if (!product) {
                    showToast('Product not found', 'error');
                    return;
                }

                const { data, ok, status } = await apiCall('POST', '/cart/items', {
                    productCode: product.id,
                    productName: product.name,
                    price: product.price,
                    quantity: quantity
                }, {
                    'X-User-Id': getUserId()
                });

                if (ok) {
                    cart = data.data;
                    updateCartUI();
                    showToast('Added to cart!');
                    openCart();
                } else {
                    // Extract error message from response
                    const errorMessage = data?.message || data?.error || `Error ${status}: Failed to add to cart`;
                    showToast(errorMessage, 'error');
                    
                    // If unauthorized, prompt user to login
                    if (status === 401) {
                        setTimeout(() => openAuthModal('login'), 500);
                    }
                }
            } catch (error) {
                showToast(error.message || 'Could not connect to server', 'error');
            }
        }

        function openCart() {
            document.getElementById('cartOverlay').classList.add('open');
            document.body.style.overflow = 'hidden';
        }

        function closeCart() {
            document.getElementById('cartOverlay').classList.remove('open');
            document.body.style.overflow = '';
        }

        async function removeCartItem(itemId) {
            try {
                const { data, ok, status } = await apiCall('DELETE', `/cart/items/${itemId}`, null, {
                    'X-User-Id': getUserId()
                });

                if (ok) {
                    cart = data.data;
                    updateCartUI();
                    showToast('Item removed from cart');
                } else {
                    const errorMessage = data?.message || data?.error || `Error ${status}`;
                    showToast(errorMessage, 'error');
                }
            } catch (error) {
                showToast(error.message || 'Could not remove item', 'error');
            }
        }

        async function clearCart() {
            if (!confirm('Are you sure you want to clear your cart?')) {
                return;
            }

            try {
                const { data, ok, status } = await apiCall('DELETE', '/cart/clear', null, {
                    'X-User-Id': getUserId()
                });

                if (ok) {
                    cart = data.data;
                    updateCartUI();
                    showToast('Cart cleared');
                } else {
                    const errorMessage = data?.message || data?.error || `Error ${status}`;
                    showToast(errorMessage, 'error');
                }
            } catch (error) {
                showToast(error.message || 'Could not clear cart', 'error');
            }
        }

        function checkout() {
            if (!currentUser) {
                closeCart();
                openAuthModal('login');
                showToast('Please sign in to checkout', 'info');
                return;
            }
            showToast('Checkout coming soon!', 'info');
        }

        // Auth
        function updateAuthUI() {
            const loggedOutMenu = document.getElementById('loggedOutMenu');
            const loggedInMenu = document.getElementById('loggedInMenu');
            const userEmail = document.getElementById('userEmail');

            if (currentUser && authToken) {
                loggedOutMenu.style.display = 'none';
                loggedInMenu.style.display = 'block';
                userEmail.textContent = currentUser.email;
            } else {
                loggedOutMenu.style.display = 'block';
                loggedInMenu.style.display = 'none';
            }
        }

        function toggleUserMenu() {
            document.getElementById('userDropdown').classList.toggle('show');
        }

        function openAuthModal(tab = 'login') {
            document.getElementById('authModal').classList.add('open');
            document.body.style.overflow = 'hidden';
            switchAuthTab(tab);
        }

        function closeAuthModal() {
            document.getElementById('authModal').classList.remove('open');
            document.body.style.overflow = '';
        }

        function switchAuthTab(tab) {
            document.querySelectorAll('.modal-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.auth-form').forEach(f => f.classList.remove('active'));

            document.querySelector(`.modal-tab:${tab === 'login' ? 'first-child' : 'last-child'}`).classList.add('active');
            document.getElementById(`${tab}Form`).classList.add('active');
        }

        async function handleLogin(event) {
            event.preventDefault();
            const btn = document.getElementById('loginBtn');
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            btn.disabled = true;
            btn.textContent = 'Signing in...';

            try {
                const { data, ok } = await apiCall('POST', '/member/login', { email, password });

                if (ok && data.data?.token) {
                    authToken = data.data.token;
                    currentUser = { email, id: data.data.userId || 1 };
                    localStorage.setItem('authToken', authToken);
                    localStorage.setItem('user', JSON.stringify(currentUser));
                    
                    updateAuthUI();
                    closeAuthModal();
                    loadCart();
                    showToast('Welcome back!');
                } else {
                    showToast(data.message || 'Login failed', 'error');
                }
            } catch (error) {
                showToast('Could not connect to server', 'error');
            }

            btn.disabled = false;
            btn.textContent = 'Sign In';
        }

        async function handleRegister(event) {
            event.preventDefault();
            const btn = document.getElementById('registerBtn');
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;

            btn.disabled = true;
            btn.textContent = 'Creating account...';

            try {
                const { data, ok } = await apiCall('POST', '/member/register', { email, password });

                if (ok) {
                    showToast('Account created! Please sign in.');
                    switchAuthTab('login');
                    document.getElementById('loginEmail').value = email;
                } else {
                    showToast(data.message || 'Registration failed', 'error');
                }
            } catch (error) {
                showToast('Could not connect to server', 'error');
            }

            btn.disabled = false;
            btn.textContent = 'Create Account';
        }

        async function logout() {
            try {
                await apiCall('POST', '/member/logout');
            } catch (e) {}

            authToken = '';
            currentUser = null;
            localStorage.removeItem('authToken');
            localStorage.removeItem('user');
            cart = { items: [] };
            
            updateAuthUI();
            updateCartUI();
            showToast('Signed out successfully');
        }

        // Close dropdowns when clicking outside
        document.addEventListener('click', (e) => {
            if (!e.target.closest('.user-menu')) {
                document.getElementById('userDropdown').classList.remove('show');
            }
        });

        // Close modals with Escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeAuthModal();
                closeProductModal();
                closeCart();
            }
        });
    </script>
</body>
</html>

